# Реализация bot-api 1С-Коннект на OneScript

Библиотека является оберткой над bot-api 1С-Коннект на OneScript. Ознакомиться с api можно [здесь](https://1c-connect.atlassian.net/wiki/spaces/PUBLIC/pages/1355841626)

## Установка

1. Склонировать репозиторий
2. Запустить ``install.bat``

## Использование

Самый простой способ:

```bsl

#Использовать 1c-connect-api

Бот = Новый КоннектБот("login", "password");

```

Логин и пароль можно разместить в специально предназначенных переменных среды:

``CONNECT_API_LOGIN`` - логин
``CONNECT_API_PASSWORD`` - пароль

Таким образом, создать объект бота можно, используя специальные методы получения значений переменных среды:

```bsl

#Использовать 1c-connect-api

Бот = Новый КоннектБот(
	Авторизация.Пользователь(), 
	Авторизация.Пароль()
);

```

### Использование в проектах, основанных на фреймворках ОСень (autumn), winow

Самый простой способ, в файле main.os, который является инициализирующим модулем проекта на ОСени, добавить примерно такой код:

```bsl

#Использовать autumn
#Использовать winow
#Использовать 1c-connect-api

Поделка = Новый Поделка;
Поделка.ДобавитьЖелудь(Тип("КоннектБот"));
Поделка.ДобавитьДуб(Тип("ДанныеАвторизации"));
Поделка.ЗапуститьПриложение();

```

Если это проект, использующий фреймворк winow, то в контроллере, который будет обрабатывать запросы, нужно описать класс примерно следующим образом:

```bsl

Перем _Поделка;
Перем _Бот;

&Контроллер("/")
Процедура ПриСозданииОбъекта(&Пластилин Поделка, &Пластилин КоннектБот)

	_Бот = КоннектБот;
	_Поделка = Поделка;

КонецПроцедуры

```

Здесь ОСень сама проинициализирует объект бота, подставит данные авторизации и передаст его в контроллер. Таким образом, объект можно использовать в обработчиках точек маршрута.

## Примеры

### Отправить сообщение

```bsl

    Клавиатура = Новый КоннектКлавиатура()
                .Кнопка(
                    Новый КоннектКнопка()
                    .Ид("button1")
                    .Текст("Кнопка1")
                )
                .Кнопка(
                    Новый КоннектКнопка()
                    .Ид("button2")
                    .Текст("Кнопка2")
                )
                .ПостроитьРяд();
    Ответ = Бот.ОтправитьСообщениеПоЛинииПоддержки()
            .ИдЛинииПоддержки("line_id")
            .ИдПользователя("user_id")
            .Текст("Здравствуйте. Это тестовое сообщение")
            .Клавиатура(Клавиатура)
            .Вызвать();

```
